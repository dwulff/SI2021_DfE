---
title: "Risk tool(s) results"
author: "<a href='https://dwulff.github.io/'>Dirk Wulff</a>"
output: html_document
---

```{r, echo=F, message=F}
require(tidyverse)
```

This script analyses the data generated by the interactive element designed to evaluate the Risktool and its components as originally studied by Kaufmann, Weber, & Haisley (2013).

### Load data

```{r, message=FALSE}
# load responses
risk_tool_data = readr::read_csv('https://dwulff.github.io/EADM_SS2018/_sessions/RiskTool/risk_tool_data.csv') # change to web link

# load problems
risk_tool_problems = readr::read_csv('https://dwulff.github.io/EADM_SS2018/_sessions/RiskTool/problems_long.csv')
```

### Data

```{r, message=FALSE, fig.height=3}
ggplot(data = risk_tool_data,
       mapping = aes(x = condition, y = allocation_risky)) + 
  geom_bar(stat = "summary", fun.y = "length") +
  labs(x = "Condition", y = "N data points") + 
  theme_light()
```


### Impact on investments

```{r, message=FALSE, fig.height=3}
ggplot(data = risk_tool_data,
       mapping = aes(x = condition, y = allocation_risky)) + 
  geom_bar(stat = "summary", fun.y = "mean") +
  labs(x = "Condition", y = "Investment in risky option") + 
  theme_light()
```

### Impact on returns

```{r, message=FALSE, fig.height=3}
ggplot(data = risk_tool_data,
       mapping = aes(x = condition, y = fiveYear)) + 
  geom_bar(stat = "summary", fun.y = "mean") +
  labs(x = "Condition", y = "Investment in risky option") + 
  theme_light()
```

### Impact on the relationship between luck and investment change

```{r, message=FALSE, fig.height=3, message=F, warning=F}
# determine expectations
expect_fun = function(x) {
  x[3] * (1 + x[1]/100)**5 + (100 - x[3]) * (1 + x[2]/100)**5
  }
expect = apply(cbind(risk_tool_problems[risk_tool_data$problem + 1, c(1,3)], 
                     risk_tool_data$allocation_risky), 1, expect_fun)

# determine luck = payoff - expectation
risk_tool_data$luck = risk_tool_data$fiveYear - expect

# plot
risk_tool_data %>%
  mutate(change = allocation_risky - subsequent_allocation_risky) %>%
ggplot(mapping = aes(x = luck, y = change)) + 
  geom_point() +
  geom_smooth() +
  labs(x = 'Luck', y = 'Change in investment\nin risky option') +
  facet_grid(~condition) + theme_light()
```

### Impact on risk perception
```{r, message=FALSE, fig.height=3, message=F, warning=F}
# long data
long_risk_tool_data = gather(risk_tool_data,'variable','value',-id,-condition,-problem)

# plot ratings
rating_vars = c('perception','confidence','informed','satisfied')
long_risk_tool_data %>% filter(variable %in% rating_vars) %>%
  ggplot(mapping = aes(x = variable, y = value)) + 
  geom_bar(stat = "summary", fun.y = "mean") +
  facet_grid(~condition) + 
  labs(x = '', y = 'Rating') +
  theme_light() + 
  theme(axis.text.x = element_text(angle = 90, hjust = 1))

# plot open formats
rating_vars = c('perceived_return','perceived_loss','perceived_upside')
long_risk_tool_data %>% filter(variable %in% rating_vars) %>%
  ggplot(mapping = aes(x = variable, y = value)) + 
  geom_bar(stat = "summary", fun.y = "mean") + 
  facet_grid(~condition) + 
  labs(x = '', y = 'Judgment') +
  theme_light() + 
  theme(axis.text.x = element_text(angle = 90, hjust = 1))

```


## Question mapping

- perception = How risky do you perceive Found B (the risky found) to be?
- confidence = How confident do you feel about investing in the risky found?
- perceived_return = If we put 100 Euro in the riskier found, what is the expected return of the 100 Euro after five years? 
- perceived_loss = If we put 100 Euro in the riskier found, in how many out of 100 cases will the return fall below 100 Euro after five years?
- perceived_upside = If we put 100 Euro in the riskier found, in how many out of 100 cases will the return fall be above 150 Euro after five years?
- informed = How informed do you feel about the funds?
- satisfied = How satisfied are you with your return?
